<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Login Test - VeriBits</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #00ff00; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; background: #00ff00; color: #000; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üî¨ VeriBits Web Login Test</h1>

    <div class="test">
        <h2>Test 1: Check if main.js loads</h2>
        <div id="test1"></div>
    </div>

    <div class="test">
        <h2>Test 2: Check if auth.js loads</h2>
        <div id="test2"></div>
    </div>

    <div class="test">
        <h2>Test 3: Test API Request Function</h2>
        <button onclick="testApiRequest()">Run API Test</button>
        <div id="test3"></div>
    </div>

    <div class="test">
        <h2>Test 4: Test Login with rams3377@gmail.com</h2>
        <button onclick="testLogin()">Test Login</button>
        <div id="test4"></div>
    </div>

    <div class="test">
        <h2>Test 5: Test Login Flow (like web form does)</h2>
        <form id="test-login-form">
            <input type="email" id="email" value="rams3377@gmail.com" style="padding: 10px; width: 300px;">
            <input type="password" id="password" value="Password@123" style="padding: 10px; width: 300px; margin-left: 10px;">
            <button type="submit" style="margin-left: 10px;">Submit Form</button>
        </form>
        <div id="test5"></div>
    </div>

    <div class="test">
        <h2>Console Output</h2>
        <pre id="console"></pre>
    </div>

    <script src="https://veribits.com/assets/js/main.js?v=test"></script>
    <script src="https://veribits.com/assets/js/auth.js?v=test"></script>

    <script>
        const consoleLog = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;

        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleLog.textContent += args.join(' ') + '\n';
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            consoleLog.textContent += '[ERROR] ' + args.join(' ') + '\n';
        };

        // Test 1: Check if main.js loaded
        document.getElementById('test1').innerHTML = typeof apiRequest !== 'undefined'
            ? '<span class="success">‚úÖ main.js loaded - apiRequest function exists</span>'
            : '<span class="error">‚ùå main.js NOT loaded - apiRequest function missing</span>';

        // Test 2: Check if auth.js loaded
        document.getElementById('test2').innerHTML = typeof loginForm !== 'undefined'
            ? '<span class="success">‚úÖ auth.js loaded</span>'
            : '<span class="error">‚ùå auth.js NOT loaded</span>';

        // Test 3: API Request Test
        async function testApiRequest() {
            const output = document.getElementById('test3');
            output.innerHTML = '<p>Testing API request...</p>';

            try {
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: 'rams3377@gmail.com',
                        password: 'Password@123'
                    })
                });

                console.log('API Response:', JSON.stringify(response, null, 2));
                output.innerHTML = '<span class="success">‚úÖ API Request Successful</span>';
                output.innerHTML += '<pre>' + JSON.stringify(response, null, 2) + '</pre>';

            } catch (error) {
                console.error('API Error:', error);
                output.innerHTML = '<span class="error">‚ùå API Request Failed: ' + error.message + '</span>';
            }
        }

        // Test 4: Login Test
        async function testLogin() {
            const output = document.getElementById('test4');
            output.innerHTML = '<p>Testing login flow...</p>';

            try {
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        email: 'rams3377@gmail.com',
                        password: 'Password@123'
                    })
                });

                console.log('Login Response:', response);
                console.log('Has data?', !!response.data);
                console.log('Has data.access_token?', !!(response.data && response.data.access_token));
                console.log('Has data.user?', !!(response.data && response.data.user));

                if (response.data && response.data.access_token) {
                    output.innerHTML = '<span class="success">‚úÖ Login Flow Works!</span>';
                    output.innerHTML += '<p>Token: ' + response.data.access_token.substring(0, 50) + '...</p>';
                    output.innerHTML += '<p>User: ' + JSON.stringify(response.data.user) + '</p>';
                } else {
                    output.innerHTML = '<span class="error">‚ùå Login Response Invalid Structure</span>';
                    output.innerHTML += '<pre>' + JSON.stringify(response, null, 2) + '</pre>';
                }

            } catch (error) {
                console.error('Login Error:', error);
                output.innerHTML = '<span class="error">‚ùå Login Failed: ' + error.message + '</span>';
            }
        }

        // Test 5: Form submission test
        document.getElementById('test-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const output = document.getElementById('test5');
            output.innerHTML = '<p>Testing form submission...</p>';

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            console.log('Form values:', { email, password });

            try {
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });

                console.log('Form Login Response:', response);

                if (response.data && response.data.access_token) {
                    setAuthToken(response.data.access_token);
                    localStorage.setItem('veribits_user', JSON.stringify(response.data.user));
                    output.innerHTML = '<span class="success">‚úÖ Form Login Successful!</span>';
                    output.innerHTML += '<p>Token saved to localStorage</p>';
                    output.innerHTML += '<p>Would redirect to: /dashboard.php</p>';
                } else {
                    output.innerHTML = '<span class="error">‚ùå Invalid Response Structure</span>';
                    output.innerHTML += '<pre>' + JSON.stringify(response, null, 2) + '</pre>';
                }
            } catch (error) {
                console.error('Form Login Error:', error);
                output.innerHTML = '<span class="error">‚ùå Form Login Failed: ' + error.message + '</span>';
            }
        });

        console.log('Test page loaded');
        console.log('API_BASE:', typeof API_BASE !== 'undefined' ? API_BASE : 'undefined');
    </script>
</body>
</html>
